<?xml version="1.0" standalone="yes"?>
<beast version='2.0'
       namespace='beast.evolution.alignment:beast.evolution.speciation:beast.core:beast.evolution.tree.coalescent:beast.util:beast.core.util:beast.evolution.likelihood:beast.math.distributions:beast.evolution.operators'>

    <!-- for Figure 9.1 in BEAST2 book -->

    <taxonset spec='TaxonSet' id='taxa'>
        <taxon spec='Taxon' id='1'/>
        <taxon spec='Taxon' id='2'/>
        <taxon spec='Taxon' id='3'/>
        <taxon spec='Taxon' id='4'/>
    </taxonset>

    <data id="alignment" dataType="nucleotide">
        <sequence taxon="1">A</sequence>
        <sequence taxon="2">A</sequence>
        <sequence taxon="3">A</sequence>
        <sequence taxon="4">A</sequence>
    </data>

    <input spec='YuleModel' id="yule">
        <parameter name='birthDiffRate' id="birthRate" value="1"/>
        <tree spec='TreeParser' id='tree' taxa='@alignment'
              newick='(((1:1.0,2:1.0):1.0,3:2.0):1.0,4:3.0);'/>
    </input>

    <distribution id='rootPrior' spec='beast.math.distributions.MRCAPrior' tree='@tree' monophyletic='true'>
        <taxonset spec='TaxonSet' id='all'>
            <taxon idref='1'/>
            <taxon idref='2'/>
            <taxon idref='3'/>
            <taxon idref='4'/>
        </taxonset>
        <distr id='logNormalDistribution' spec='beast.math.distributions.LogNormalDistributionModel'>
            <parameter name='M' value='2'/>
            <parameter name='S' value='0.2'/>
        </distr>
    </distribution>

    <run spec="MCMC" id="mcmc" chainLength="1000000">

        <state>
            <stateNode idref='tree'/>
            <stateNode idref="birthRate"/>
        </state>

        <distribution spec='CompoundDistribution' id='posterior'>
            <distribution id="yule.prior" idref='yule'/>
            <distribution idref="rootPrior"/>

            <distribution id="birthRate.prior" spec="beast.math.distributions.Prior" x="@birthRate">
                <distr id="OneOnX" offset="0.0" spec="beast.math.distributions.OneOnX"/>
            </distribution>

        </distribution>

        <operator spec='SubtreeSlide' weight="4" gaussian="true" size="2.5" tree="@tree"/>
        <operator spec="ScaleOperator" weight="1" scaleFactor="0.25">
            <parameter idref="birthRate"/>
        </operator>

        <logger logEvery="100" fileName="classic_root_prior_oneOnX.$(seed).log">
            <model idref='posterior'/>
            <log idref="posterior"/>
            <log idref="yule"/>
            <log spec='beast.math.distributions.MRCAPrior' tree='@tree' id='all.age' taxonset='@all' />
            <log idref="birthRate"/>
        </logger>
        <logger logEvery="100" fileName="classic_root_prior_oneOnX.$(seed).trees">
            <log idref="tree"/>
        </logger>
        <logger logEvery="100">
            <model idref='posterior'/>
            <log idref="yule"/>
            <log idref="birthRate"/>
        </logger>
    </run>
</beast>
